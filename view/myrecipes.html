<!doctype html>
<html class="no-js" lang="zxx">

<head>
   <meta charset="utf-8">
   <meta http-equiv="x-ua-compatible" content="ie=edge">
   <title>Tasty Recipes</title>
   <meta name="description" content="">
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <!-- <link rel="manifest" href="site.webmanifest"> -->
   <!-- Place favicon.ico in the root directory -->

   <!-- CSS here -->
   <link rel="stylesheet" href="css/bootstrap.min.css">
   <link rel="stylesheet" href="css/owl.carousel.min.css">
   <link rel="stylesheet" href="css/magnific-popup.css">
   <link rel="stylesheet" href="css/font-awesome.min.css">
   <link rel="stylesheet" href="css/themify-icons.css">
   <link rel="stylesheet" href="css/nice-select.css">
   <link rel="stylesheet" href="css/flaticon.css">
   <link rel="stylesheet" href="css/gijgo.css">
   <link rel="stylesheet" href="css/animate.min.css">
   <link rel="stylesheet" href="css/slick.css">
   <link rel="stylesheet" href="css/slicknav.css">
   <link rel="stylesheet" href="css/style.css">
   <!-- <link rel="stylesheet" href="css/responsive.css"> -->
</head>

<body>
   <!--[if lte IE 9]>
           <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
       <![endif]-->

       <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top p-3">
           <div class="typography">
             <a class="navbar-brand" style="font-size: x-large;" href="#">FindMyRecipe</a>
           </div>
     
           <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
             <span class="navbar-toggler-icon"></span>
           </button>
           <div class="collapse navbar-collapse" id="navbarNav">
             <ul class="navbar-nav ml-auto" style="font-size: large;">
               <!-- Find Recipes Link -->
               <li class="nav-item">
                 <a class="nav-link" href="index.html">Find Recipes</a>
               </li>
               
               <!-- My Recipes Link (only visible if logged in) -->
               <li class="nav-item active" id="my-recipes-link" style="display: none;">
                 <a class="nav-link" href="myrecipes.html">My Recipes<span class="sr-only">(current)</span></a>
               </li>
               
               <!-- Login/Sign Up Link (only visible if NOT logged in) -->
               <li class="nav-item" id="login-link">
                 <a class="nav-link" href="login.html">Login/Sign Up</a>
               </li>
         
               <!-- Edit Profile Link (only visible if logged in) -->
               <li class="nav-item" id="profile-link" style="display: none;">
                 <a class="nav-link" href="profile.html">Edit Profile</a>
               </li>
         
               <!-- Logout Link (only visible if logged in) -->
               <li class="nav-item" id="logout-link" style="display: none;">
                 <a class="nav-link" href="#" id="logout-link">Logout</a>
               </li>
             </ul>
           </div>
         </nav>
   <!-- bradcam_area  -->
   <div class="bradcam_area breadcam_bg_2">
       <div class="container">
           <div class="row">
               <div class="col-xl-12">
                   <div class="bradcam_text text-center">
                       <h3>My Recipes</h3>
                   </div>
               </div>
           </div>
       </div>
   </div>
   <!-- /bradcam_area  -->

   <!-- page_section_start -->
   <div class="recepie_videoes_area">
       <div class="container">
           <div class="row">
               <div class="col-xl-6 col-lg-6 col-md-6">
                   <div class="recepie_info">
                       <h3>Your Personal Recipe Collection</h3>
                       <h4 class="p-3">View and manage all the recipes you've added to your favorites. Keep track of your culinary adventures and easily revisit your top picks!</h2>
                   <div class="video_watch d-flex align-items-center">
                   </div>
                   </div>
               </div>
               <div class="col-lg-6 col-md-6">
                   <div class="videos_thumb">
                       <div class="big_img">
                           <img src="img/video/big.png" alt="">
                       </div>
                       <div class="small_thumb">
                           <img src="img/video/small_1.png" alt="">
                       </div>
                       <div class="small_thumb_2">
                           <img src="img/video/2.png" alt="">
                       </div>
                   </div>
               </div>
           </div>

       <!-- recepie_area_start  -->
       <div class="recepie_area plus_padding">
           <!-- Search Bar Section -->
           <div class="input-group rounded p-5">
               <input type="search" class="form-control rounded" placeholder="Search by recipe name" id="search-bar"/>
               <!-- Filter Dropdown -->
               <div class="default-select" id="default-select">
                   <select id="category-filter">
                       <option value="">Search by Filter</option>
                       <option value="Vegetarian">Vegetarian</option>
                       <option value="Salad">Salad</option>
                           <option value="Soup">Soup</option>
                       <option value="Breakfast">Breakfast</option>
                       <option value="Dessert">Dessert</option>
                       <option value="Italian">Italian</option>
                       <option value="Mexican">Mexican</option>
                       <option value="Indian">Indian</option>
                       <option value="Japanese">Japanese</option>
                       <option value="Chinese">Chinese</option>
                       <option value="Thai">Thai</option>
           
                   </select>
               </div>
           </div>
           <div class="container">
               <div class="row">
                           <!-- Recipes will be injected here by JavaScript -->
               </div>
           </div>
       </div>
   </div>
   <!-- page_section_end -->

   <!-- footer  -->
   <footer class="footer">
       <div class="footer_top">
           <div class="container">
               <div class="row">
                   <div class="col-xl-2 col-md-6 col-lg-2">
                       <div class="footer_widget">
                           <h3 class="footer_title">
                               Explore Recipes
                           </h3>
                           <ul>
                               <li><a href="#">Popular Recipes</a></li>
                               <li><a href="#"> Newest Additions</a></li>
                               <li><a href="#">Trending Dishes</a></li>
                               <li><a href="#">Seasonal Favorites</a></li>
                           </ul>

                       </div>
                   </div>
                   <div class="col-xl-2 col-md-6 col-lg-2">
                       <div class="footer_widget">
                           <h3 class="footer_title">
                               Categories
                           </h3>
                           <ul>
                               <li><a href="#">Breakfast Recipes</a></li>
                               <li><a href="#">Quick & Easy</a></li>
                               <li><a href="#">Healthy Choices</a></li>
                               <li><a href="#">Desserts</a></li>
                           </ul>
                       </div>
                   </div>
                   <div class="col-xl-2 col-md-6 col-lg-2">
                       <div class="footer_widget">
                           <h3 class="footer_title">
                               Quick Links
                           </h3>
                           <ul>
                               <li><a href="#">FAQ</a></li>
                               <li><a href="#">Privacy Policy</a></li>
                               <li><a href="#">Terms of Service</a></li>
                           </ul>

                       </div>
                   </div>
                   <div class="col-xl-2 col-md-6 col-lg-2">
                       <div class="footer_widget">
                           <h3 class="footer_title">
                               Support
                           </h3>
                           <ul>
                               <li><a href="#">Help Center</a></li>
                               <li><a href="#">Account Settings</a></li>
                               <li><a href="#">Report an Issue</a></li>
                           </ul>

                       </div>
                   </div>
                   <div class="col-xl-4 col-md-6 col-lg-4">
                           <div class="footer_widget">
                                   <h3 class="footer_title">
                                           Subscribe
                                   </h3>
                                   <p class="newsletter_text">Subscribe to our newsletter for weekly recipes.</p>
                                   <form action="#" class="newsletter_form">
                                       <input type="text" placeholder="Enter your mail">
                                       <button type="submit"> <i class="ti-arrow-right"></i> </button>
                                   </form>
                                   
                           </div>
                   </div>
               </div>
           </div>
       </div>
       <div class="copy-right_text">
           <div class="container">
               <div class="footer_border"></div>
               <div class="row align-items-center">
                   <div class="col-xl-8 col-md-8">
                       <p class="copy_right">
                           <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                       </p>
                   </div>
                   <div class="col-xl-4 col-md-4">
                       <div class="socail_links">
                           <ul>
                               <li>
                                   <a href="#">
                                       <i class="ti-facebook"></i>
                                   </a>
                               </li>
                               <li>
                                   <a href="#">
                                       <i class="ti-twitter-alt"></i>
                                   </a>
                               </li>
                               <li>
                                   <a href="#">
                                       <i class="fa fa-dribbble"></i>
                                   </a>
                               </li>
                               <li>
                                   <a href="#">
                                       <i class="fa fa-behance"></i>
                                   </a>
                               </li>
                           </ul>
                       </div>
                   </div>
               </div>
           </div>
       </div>
   </footer>
<!--/ footer  -->

   <!-- JS here -->
   <script src="js/vendor/modernizr-3.5.0.min.js"></script>
   <script src="js/vendor/jquery-1.12.4.min.js"></script>
   <script src="js/popper.min.js"></script>
   <script src="js/bootstrap.min.js"></script>
   <script src="js/owl.carousel.min.js"></script>
   <script src="js/isotope.pkgd.min.js"></script>
   <script src="js/ajax-form.js"></script>
   <script src="js/waypoints.min.js"></script>
   <script src="js/jquery.counterup.min.js"></script>
   <script src="js/imagesloaded.pkgd.min.js"></script>
   <script src="js/scrollIt.js"></script>
   <script src="js/jquery.scrollUp.min.js"></script>
   <script src="js/wow.min.js"></script>
   <script src="js/nice-select.min.js"></script>
   <script src="js/jquery.slicknav.min.js"></script>
   <script src="js/jquery.magnific-popup.min.js"></script>
   <script src="js/plugins.js"></script>
   <script src="js/gijgo.min.js"></script>

   <!--contact js-->
   <script src="js/contact.js"></script>
   <script src="js/jquery.ajaxchimp.min.js"></script>
   <script src="js/jquery.form.js"></script>
   <script src="js/jquery.validate.min.js"></script>
   <script src="js/mail-script.js"></script>

   <script src="js/main.js"></script>
   <script>
    // Redirect to login if not authenticated
    fetch("/check-session")
    .then((response) => response.json())
    .then((data) => {
        if (!data.loggedIn) {
        alert("You need to log in to access this page."); 
        window.location.href = "/login.html"; // Redirect to login page
        }
    })
    .catch((error) => {
        console.error("Error checking session:", error);
    });

    document.addEventListener('DOMContentLoaded', () => {
       let allRecipes = []; // Array to store all the recipes fetched

       // Fetch recipes on page load
       fetch('/my-saved-recipes', {
           method: 'GET',
           headers: {
               'Content-Type': 'application/json'
           }
       })
       .then(response => response.json())
       .then(data => {
           if (data.savedRecipes) {
               allRecipes = data.savedRecipes; // Store all fetched recipes
               displayRecipes(allRecipes); // Display all recipes initially
           } else {
               console.log('No recipes found.');
           }
       })
       .catch(error => console.error('Error fetching recipes:', error));

       // Search functionality
       const searchInput = document.getElementById('search-bar');
       searchInput.addEventListener('input', () => {
           const searchQuery = searchInput.value.toLowerCase();
           const selectedCategory = document.getElementById('category-filter').value;
           
           // Filter recipes by both search query and selected category
           const filteredRecipes = allRecipes.filter(recipe => 
               recipe.title.toLowerCase().includes(searchQuery) &&
               (selectedCategory === "" || recipe.category.toLowerCase() === selectedCategory.toLowerCase())
           );
           displayRecipes(filteredRecipes); // Update the displayed recipes based on search and category
       });

       // Category filter functionality
       const categoryFilter = document.getElementById('category-filter');
       categoryFilter.addEventListener('change', () => {
           const selectedCategory = categoryFilter.value;
           const searchQuery = searchInput.value.toLowerCase(); // Get current search query

           // Filter recipes by both selected category and search query
           const filteredRecipes = allRecipes.filter(recipe => 
               recipe.title.toLowerCase().includes(searchQuery) &&
               (selectedCategory === "" || recipe.category.toLowerCase() === selectedCategory.toLowerCase())
           );
           displayRecipes(filteredRecipes); // Update the displayed recipes based on category and search
       });

       // Function to display recipes
       function displayRecipes(recipes) {
           const recipesContainer = document.querySelector('.recepie_area .row');
           recipesContainer.innerHTML = ''; // Clear existing content

           if (recipes.length === 0) {
               recipesContainer.innerHTML = '<p>No recipes found</p>'; // Display message if no recipes found
           } else {
               recipes.forEach(recipe => {
                   const recipeHTML = `
                       <div class="col-xl-4 col-lg-4 col-md-6">  
                           <div class="single_recepie text-center">
                               <div class="recepie_thumb">
                                   <img src="${recipe.image || 'img/placeholder.png'}" alt="${recipe.title}">
                               </div>
                               <h3>${recipe.title}</h3>
                               <span>${recipe.category || 'Uncategorized'}</span>
                               <p>Time Needed: ${recipe.time || 'Unknown'}</p>
                               <a href="recipes_details.html?id=${recipe._id}" class="line_btn">View Full Recipe</a>
                               <a href="#" class="line_btn remove-recipe" data-recipe-id="${recipe._id}">Remove</a>
                           </div>
                       </div>
                   `;
                   recipesContainer.innerHTML += recipeHTML;
               });

               // Attach event listeners to Remove buttons
               document.querySelectorAll('.remove-recipe').forEach(button => {
                   button.addEventListener('click', (e) => {
                       e.preventDefault();
                       removeSavedRecipe(button.dataset.recipeId);
                   });
               });
           }
       }

       // Function to remove saved recipe
       function removeSavedRecipe(recipeId) {
           fetch('/remove-saved-recipe', {
               method: 'POST',
               headers: {
                   'Content-Type': 'application/json'
               },
               body: JSON.stringify({ recipeId })
           })
           .then(response => response.json())
           .then(data => {
               if (data.msg === 'Recipe removed successfully!') {
                   alert('Recipe removed!');
                   document.querySelector(`.remove-recipe[data-recipe-id="${recipeId}"]`).closest('.col-xl-4').remove();
               } else {
                   alert('Failed to remove recipe: ' + (data.msg || 'Unknown error'));
               }
           })
           .catch(error => console.error('Error removing recipe:', error));
       }
   });
   </script>
   
</body>

</html>