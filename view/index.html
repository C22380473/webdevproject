<!-- 
Bootstrap template used from Colorlib 
Source: https://themewagon.com/themes/free-bootstrap-4-html5-cooking-website-template-tasty-recipes/
-->

<!DOCTYPE html>
<html class="no-js" lang="zxx">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Tasty Recipes</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- <link rel="manifest" href="site.webmanifest"> -->
    <!-- Place favicon.ico in the root directory -->

    <!-- CSS here -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/magnific-popup.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/themify-icons.css" />
    <link rel="stylesheet" href="css/nice-select.css" />
    <link rel="stylesheet" href="css/flaticon.css" />
    <link rel="stylesheet" href="css/gijgo.css" />
    <link rel="stylesheet" href="css/animate.min.css" />
    <link rel="stylesheet" href="css/slick.css" />
    <link rel="stylesheet" href="css/slicknav.css" />
    <link rel="stylesheet" href="css/style.css" />
    <!-- <link rel="stylesheet" href="css/responsive.css"> -->
  </head>

  <body>
    <!--[if lte IE 9]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="https://browsehappy.com/">upgrade your browser</a> to improve
        your experience and security.
      </p>
    <![endif]-->

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top p-3">
      <div class="typography">
        <a class="navbar-brand" style="font-size: x-large" href="#"
          >FindMyRecipe</a
        >
      </div>

      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto" style="font-size: large">
          <!-- Find Recipes Link -->
          <li class="nav-item active">
            <a class="nav-link" href="index.html"
              >Find Recipes <span class="sr-only">(current)</span></a
            >
          </li>

          <!-- My Recipes Link (only visible if logged in) -->
          <li class="nav-item" id="my-recipes-link" style="display: none">
            <a class="nav-link" href="myrecipes.html">My Recipes</a>
          </li>

          <!-- Login/Sign Up Link (only visible if NOT logged in) -->
          <li class="nav-item" id="login-link">
            <a class="nav-link" href="login.html">Login/Sign Up</a>
          </li>

          <!-- Edit Profile Link (only visible if logged in) -->
          <li class="nav-item" id="profile-link" style="display: none">
            <a class="nav-link" href="profile.html">Edit Profile</a>
          </li>

          <!-- Logout Link (only visible if logged in) -->
          <li class="nav-item" id="logout-link" style="display: none">
            <a class="nav-link" href="#" id="logout-link">Logout</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- slider_area_start -->
    <div class="slider_area">
      <div class="single_slider d-flex align-items-center slider_bg_1">
        <div class="container">
          <div class="row align-items-center justify-content-center">
            <div class="col-xl-8">
              <div class="slider_text text-center">
                <div class="text">
                  <h3>Discover New Recipes</h3>
                </div>
                <!-- Search Bar Section -->
                <div class="button-group-area mt-40">
                  <a href="#mainpage" class="genric-btn primary e-large"
                    >Let's go</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- slider_area_end -->

    <!-- recepie_area_start  -->
    <div class="recepie_area plus_padding">
      <div class="container p-5 mb-30" id="mainpage">
        <!-- Search Bar Section -->
        <div class="input-group rounded p-5">
          <input
            type="search"
            class="form-control rounded"
            placeholder="Search by recipe name"
            id="search-bar"
          />
          <!-- Filter Dropdown -->
          <div class="default-select" id="default-select">
            <select id="category-filter">
              <option value="">Search by Filter</option>
              <option value="Vegetarian">Vegetarian</option>
              <option value="Salad">Salad</option>
              <option value="Soup">Soup</option>
              <option value="Breakfast">Breakfast</option>
              <option value="Dessert">Dessert</option>
              <option value="Italian">Italian</option>
              <option value="Mexican">Mexican</option>
              <option value="Indian">Indian</option>
              <option value="Japanese">Japanese</option>
              <option value="Chinese">Chinese</option>
              <option value="Thai">Thai</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-xl-12">
            <div class="trand_info text-center p-4">
              <h1>Top Pick Recipes</h1>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="row" id="recipe-container">
          <!-- Recipes will be dynamically inserted by JavaScript -->
        </div>
      </div>
    </div>
    <!-- /recepie_area_end  -->

    <!-- download_app_area -->
    <div class="download_app_area">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-xl-6 col-md-6">
            <div class="download_thumb">
              <div class="big_img">
                <img src="img/video/big_1.png" alt="" />
              </div>
              <div class="small_01">
                <img src="img/video/small_sm1.png" alt="" />
              </div>
              <div class="small_02">
                <img src="img/video/sm2.png" alt="" />
              </div>
            </div>
          </div>
          <div class="col-xl-6 col-md-6">
            <div class="download_text">
              <h3>Download our App to Get Recipes Everywhere</h3>
              <div class="download_android_apple">
                <a class="active" href="#">
                  <div class="download_link d-flex">
                    <i class="fa fa-apple"></i>
                    <div class="store">
                      <h5>Available</h5>
                      <p>on App Store</p>
                    </div>
                  </div>
                </a>
                <a href="#">
                  <div class="download_link d-flex">
                    <i class="fa fa-android"></i>
                    <div class="store">
                      <h5>Download</h5>
                      <p>from Play Store</p>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--/ download_app_area -->

    <!-- footer  -->
    <footer class="footer">
      <div class="footer_top">
        <div class="container">
          <div class="row">
            <div class="col-xl-2 col-md-6 col-lg-2">
              <div class="footer_widget">
                <h3 class="footer_title">Explore Recipes</h3>
                <ul>
                  <li><a href="#">Popular Recipes</a></li>
                  <li><a href="#"> Newest Additions</a></li>
                  <li><a href="#">Trending Dishes</a></li>
                  <li><a href="#">Seasonal Favorites</a></li>
                </ul>
              </div>
            </div>
            <div class="col-xl-2 col-md-6 col-lg-2">
              <div class="footer_widget">
                <h3 class="footer_title">Categories</h3>
                <ul>
                  <li><a href="#">Breakfast Recipes</a></li>
                  <li><a href="#">Quick & Easy</a></li>
                  <li><a href="#">Healthy Choices</a></li>
                  <li><a href="#">Desserts</a></li>
                </ul>
              </div>
            </div>
            <div class="col-xl-2 col-md-6 col-lg-2">
              <div class="footer_widget">
                <h3 class="footer_title">Quick Links</h3>
                <ul>
                  <li><a href="#">FAQ</a></li>
                  <li><a href="#">Privacy Policy</a></li>
                  <li><a href="#">Terms of Service</a></li>
                </ul>
              </div>
            </div>
            <div class="col-xl-2 col-md-6 col-lg-2">
              <div class="footer_widget">
                <h3 class="footer_title">Support</h3>
                <ul>
                  <li><a href="#">Help Center</a></li>
                  <li><a href="#">Account Settings</a></li>
                  <li><a href="#">Report an Issue</a></li>
                </ul>
              </div>
            </div>
            <div class="col-xl-4 col-md-6 col-lg-4">
              <div class="footer_widget">
                <h3 class="footer_title">Subscribe</h3>
                <p class="newsletter_text">
                  Subscribe to our newsletter for weekly recipes.
                </p>
                <form action="#" class="newsletter_form">
                  <input type="text" placeholder="Enter your mail" />
                  <button type="submit"><i class="ti-arrow-right"></i></button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="copy-right_text">
        <div class="container">
          <div class="footer_border"></div>
          <div class="row align-items-center">
            <div class="col-xl-8 col-md-8">
              <p class="copy_right">
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                Copyright &copy;
                <script>
                  document.write(new Date().getFullYear());
                </script>
                All rights reserved | This template is made with
                <i class="fa fa-heart-o" aria-hidden="true"></i> by
                <a href="https://colorlib.com" target="_blank">Colorlib</a>
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
              </p>
            </div>
            <div class="col-xl-4 col-md-4">
              <div class="socail_links">
                <ul>
                  <li>
                    <a href="#">
                      <i class="ti-facebook"></i>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="ti-twitter-alt"></i>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-dribbble"></i>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-behance"></i>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!--/ footer  -->

    <!-- JS here -->
    <script src="js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="js/vendor/jquery-1.12.4.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/ajax-form.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <script src="js/scrollIt.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/nice-select.min.js"></script>
    <script src="js/jquery.slicknav.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/gijgo.min.js"></script>

    <!--contact js-->
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/main.js"></script>
    <script>
      let isLoggedIn = false; // Variable to store the user's login status

      document.addEventListener("DOMContentLoaded", function () {
        checkLoginStatus(); // Check if the user is logged in
        fetchRecipes(); // Fetch and display recipes

        const searchBar = document.getElementById("search-bar");
        const categoryFilter = document.getElementById("category-filter");

        // Fetch recipes on page load
        fetchRecipes();

        // Add event listener to search bar
        searchBar.addEventListener("input", () => {
          const searchValue = searchBar.value;
          const selectedCategory = categoryFilter.value;
          fetchRecipes(selectedCategory, searchValue);
        });

        // Add event listener to dropdown filter
        categoryFilter.addEventListener("change", () => {
          const searchValue = searchBar.value;
          const selectedCategory = categoryFilter.value;
          fetchRecipes(selectedCategory, searchValue);
        });
      });

      // Function to check login status
      function checkLoginStatus() {
        fetch("/check-session")
          .then((response) => response.json())
          .then((data) => {
            isLoggedIn = data.loggedIn; // Update the isLoggedIn variable
          })
          .catch((err) => {
            console.error("Error checking login status:", err);
          });
      }

      // Function to fetch and display recipes
      function fetchRecipes(category = "", search = "") {
        fetch(`/recipes?category=${category}&search=${search}`)
          .then((response) => response.json())
          .then((recipes) => {
            const container = document.getElementById("recipe-container");
            container.innerHTML = "";

            if (recipes.length === 0) {
              container.innerHTML = "<p>No recipes available.</p>";
            } else {
              recipes.forEach((recipe) => {
                const recipeElement = document.createElement("div");
                recipeElement.classList.add("col-xl-4", "col-lg-4", "col-md-6");

                // Conditionally include the "Save Recipe" button if the user is logged in
                const saveButtonHTML = isLoggedIn
                  ? `<a href="#" class="line_btn" onclick="saveRecipe('${recipe._id}')">Save Recipe</a>`
                  : "";

                recipeElement.innerHTML = `
                        <div class="single_recepie text-center">
                            <div class="recepie_thumb">
                                <img src="${
                                  recipe.image ||
                                  "img/recepie/recpie_default.png"
                                }" alt="${recipe.title}" />
                            </div>
                            <h3>${recipe.title}</h3>
                            <span>${recipe.category || "No category"}</span>
                            <p>Time Needed: ${recipe.time || "N/A"}</p>
                            <a href="/recipes_details.html?id=${
                              recipe._id
                            }" class="line_btn">View Full Recipe</a>
                            ${saveButtonHTML} <!-- Add save button conditionally -->
                        </div>
                    `;

                container.appendChild(recipeElement);
              });
            }
          })
          .catch((err) => {
            console.error("Error fetching recipes:", err);
          });
      }

      // Function to save recipe
      function saveRecipe(recipeId) {
        if (!isLoggedIn) {
          alert("Please log in to save recipes!");
          return;
        }

        fetch("/save-recipe", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ recipeId }), // Send recipeId in the request body
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Recipe saved successfully!");
            } else {
              alert(data.msg || "Failed to save recipe.");
            }
          })
          .catch((err) => {
            console.error("Error saving recipe:", err);
            alert("An error occurred while saving the recipe.");
          });
      }
    </script>
  </body>
</html>
